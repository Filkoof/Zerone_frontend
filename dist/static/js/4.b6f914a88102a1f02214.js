webpackJsonp([4],{"QJN+":function(e,s){},ggDw:function(e,s){},uA75:function(e,s){},zfg2:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var i=t("Dd8w"),a=t.n(i),n=t("PJh5"),o=t.n(n),l=t("NYxO"),c={name:"ImDialog",props:{active:Boolean,push:Number,online:Boolean,me:Boolean,info:Object},computed:{statusText:function(){return this.online?"Онлайн":"был в сети "+o()(this.info.last_message.recipient.last_online_time).fromNow()}}},r={render:function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"im-dialog",class:{active:e.active,push:e.push}},[t("router-link",{staticClass:"im-dailog__pic",attrs:{to:{name:"ProfileId",params:{id:e.info.last_message.recipient.id}}}},[t("img",{attrs:{src:e.info.last_message.recipient.photo,alt:e.info.last_message.recipient.first_name}})]),t("div",{staticClass:"im-dialog__info"},[t("router-link",{staticClass:"im-dialog__name",attrs:{to:{name:"ProfileId",params:{id:e.info.last_message.recipient.id}}}},[e._v(e._s(e.info.last_message.recipient.first_name+" "+e.info.last_message.recipient.last_name))]),t("span",{staticClass:"user-status",class:{online:e.online}},[e._v(e._s(e.statusText))])],1),t("div",{staticClass:"im-dialog__content"},[t("p",{staticClass:"im-dialog__last"},[e.me?t("span",{staticClass:"im-dialog__last-me"},[e._v("Вы: ")]):e._e(),e._v(e._s(e.info.last_message.message_text))]),t("span",{staticClass:"im-dialog__time"},[e._v(e._s(e._f("moment")(e.info.last_message.time,"from")))])]),e.push>0?t("span",{staticClass:"im-dialog__push"},[e._v(e._s(e.push))]):e._e()],1)},staticRenderFns:[]};var m=t("VU/8")(c,r,!1,function(e){t("uA75")},null,null).exports,u={name:"ImChat",props:{info:Object,messages:Array,online:Boolean},data:function(){return{mes:""}},computed:{statusText:function(){return this.online?"Онлайн":"был в сети "+o()(this.info.last_message.recipient.last_online_time).fromNow()}},methods:a()({},Object(l.b)("profile/dialogs",["postMessage"]),{onSubmitMessage:function(){this.postMessage({id:this.info.id,message_text:this.mes}),this.mes=""}}),mounted:function(){this.$refs.messageBlock.scrollTop=this.$refs.messageBlock.scrollHeight}},_={render:function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"im-chat"},[t("div",{staticClass:"im-chat__user"},[t("router-link",{staticClass:"im-chat__user-pic",attrs:{to:{name:"ProfileId",params:{id:e.info.last_message.recipient.id}}}},[t("img",{attrs:{src:e.info.last_message.recipient.photo,alt:e.info.last_message.recipient.first_name}})]),t("router-link",{staticClass:"im-chat__user-name",attrs:{to:{name:"ProfileId",params:{id:e.info.last_message.recipient.id}}}},[e._v(e._s(e.info.last_message.recipient.first_name+" "+e.info.last_message.recipient.last_name))]),t("span",{staticClass:"user-status",class:{online:e.online}},[e._v(e._s(e.statusText))])],1),t("div",{ref:"messageBlock",staticClass:"im-chat__message"},e._l(e.messages,function(s){return t("div",{key:s.date,staticClass:"im-chat__message-day"},[t("h5",{staticClass:"im-chat__message-title"},[e._v(e._s(e._f("moment")(s.date,"DD MMMM YYYY")))]),e._l(s.messages,function(s){return t("div",{key:s.id,staticClass:"im-chat__message-block",class:{me:s.isSentByMe}},[t("p",{staticClass:"im-chat__message-text"},[e._v(e._s(s.message_text))]),t("span",{staticClass:"im-chat__message-time"},[e._v(e._s(e._f("moment")(s.time,"hh:mm")))])])})],2)}),0),t("form",{staticClass:"im-chat__enter",attrs:{action:"#"},on:{submit:function(s){return s.preventDefault(),e.onSubmitMessage(s)}}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.mes,expression:"mes"}],staticClass:"im-chat__enter-input",attrs:{type:"text",placeholder:"Ваше сообщение..."},domProps:{value:e.mes},on:{input:function(s){s.target.composing||(e.mes=s.target.value)}}})])])},staticRenderFns:[]};var g={name:"Im",components:{ImDialog:m,ImChat:t("VU/8")(u,_,!1,function(e){t("QJN+")},null,null).exports},data:function(){return{activeDialogId:null,activeDialog:null,intervalForMessages:null}},computed:a()({},Object(l.c)("profile/dialogs",["getResultById","getMessages"]),{dialogs:function(){return this.getResultById("dialogs")}}),methods:a()({},Object(l.b)("profile/dialogs",["apiDialogs","dialogsMessages"]),{countPush:function(e){return e>0?e:null},checkOnlineUser:function(e){return o()().diff(o()(e),"seconds")<=60},changeDialog:function(e){var s=this;this.activeDialogId=e,this.activeDialog=this.dialogs.find(function(s){return s.id===e}),this.intervalForMessages=setInterval(function(){s.dialogsMessages(e)},2e3)}}),beforeRouteEnter:function(e,s,t){t(function(e){e.apiDialogs().then(function(){e.$route.query.activeDialog?e.activeDialogId=e.$route.query.activeDialog:e.activeDialogId=e.dialogs[0].id,e.activeDialog=e.dialogs.find(function(s){return s.id===e.activeDialogId}),e.intervalForMessages=setInterval(function(){e.dialogsMessages(e.activeDialogId)},2e3)})})},beforeRouteLeave:function(e,s,t){this.intervalForMessages=null,t()}},d={render:function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"im"},[t("div",{staticClass:"im__dialogs"},e._l(e.dialogs,function(s){return t("im-dialog",{key:s.id,attrs:{info:s,push:e.countPush(s.unread_count),me:s.last_message.isSentByMe,active:s.id===e.activeDialogId,online:e.checkOnlineUser(s.last_message.recipient.last_online_time)},nativeOn:{click:function(t){return e.changeDialog(s.id)}}})}),1),e.activeDialog?t("div",{staticClass:"im__chat"},[t("im-chat",{attrs:{info:e.activeDialog,messages:e.getMessages,online:e.checkOnlineUser(e.activeDialog.last_message.recipient.last_online_time)}})],1):e._e()])},staticRenderFns:[]};var f=t("VU/8")(g,d,!1,function(e){t("ggDw")},null,null);s.default=f.exports}});
//# sourceMappingURL=4.b6f914a88102a1f02214.js.map